(function(e){var t="sensu",i=Math.PI/180,n={roop:true,sliceNum:10,autoplay:false,autoplaySpeed:5e3};function r(t,i){this.settings=e.extend({},n,i);this._defaults=n;this._stage=null;this.el=t;this.initialize()}r.prototype.initialize=function(){var e=this;e._stage=new createjs.Stage(this.el.id);e._stage.enableMouseOver(10);var t=new a({roop:e.settings.roop,sliceNum:e.settings.sliceNum});t.width=this.el.width;t.height=this.el.height;e._stage.addChild(t);t.on("click",function(){var e=t.getCurrentPage().url;if(!e){return}window.open(t.getCurrentPage().url)});if(e.settings.autoplay){setInterval(function(){t.goNext()},e.settings.autoplaySpeed)}var i=new c({width:this.el.width,height:this.el.height});e._stage.addChild(i);i.on("prevclick",function(){t.goPrev()});i.on("nextclick",function(){t.goNext()});createjs.Ticker.setFPS(60);createjs.Ticker.addEventListener("tick",function(){e._stage.update()});var n=new createjs.LoadQueue;n.addEventListener("complete",function(){t.setPages(n.getItems())});n.loadManifest(e.settings.list)};function a(t){var i=this;i.Container_constructor();e.extend(i,t);i.currentPage=0;i.pages=[];i.isMoving=false;i.on("afteranimate",function(){i.isMoving=false})}createjs.extend(a,createjs.Container);a.prototype.getCurrentPage=function(){return this.pages[this.currentPage]};a.prototype.setPages=function(e){e=e||[];var t=this;e.reverse();console.info(t.sliceNum);e.forEach(function(e){var i=t._createPage({img:e.result,sliceNum:t.sliceNum});i.url=e.item.url;t.pages.unshift(i);t.addChild(i)})};a.prototype._createPage=function(e){var t=this;var i=new s(e);i.on("beforeanimate",function(){t.dispatchEvent("beforeanimate")});i.on("afteranimate",function(){t.dispatchEvent("afteranimate")});return i};a.prototype.goPrev=function(){var e=this;var t=e.currentPage-1;if(e.isMoving){return}if(!e.roop&&!e.pages[t]){return}e.isMoving=true;if(t<0){t=e.getNumChildren()-1}e.pages[t].nonAnimClose();e.setChildIndex(e.pages[t],e.getNumChildren()-1);e.setChildIndex(e.getCurrentPage(),e.getNumChildren()-2);e.pages[t].open();e.currentPage=t};a.prototype.goNext=function(){var e=this;var t=e.currentPage+1;if(e.isMoving){return}if(!e.roop&&!e.pages[t]){return}e.isMoving=true;if(e.getNumChildren()-1<t){t=0}e.pages[t].nonAnimOpen();e.setChildIndex(e.getCurrentPage(),e.getNumChildren()-1);e.setChildIndex(e.pages[t],e.getNumChildren()-2);e.pages[e.currentPage].close();e.currentPage=t};createjs.promote(a,"Container");function s(e){console.info(e);e=e||{};var t=this;t.Container_constructor();t.img=e.img;t.width=e.img.width;t.height=e.img.height;t.angle=0;t.sliceNum=e.sliceNum;t.sliceWidth=t.width/t.sliceNum;t._setSlices();t.on("afteranimate",function(){t.removeAllEventListeners("tick")})}createjs.extend(s,createjs.Container);s.prototype._setSlices=function(){var e=this;for(var t=0;t<e.sliceNum;t++){var i=new o(e.img,e.sliceWidth,t);e.addChild(i)}};s.prototype.nonAnimOpen=function(){var e=this;e.angle=0;e.children.forEach(function(t){t.updateFromAngle(e.angle)})};s.prototype.open=function(){var e=this;e.dispatchEvent("beforeanimate");var t=function(){if(e.angle<0){e.dispatchEvent("afteranimate");return}e.children.forEach(function(t){t.updateFromAngle(e.angle)});e.angle--};e.on("tick",t)};s.prototype.nonAnimClose=function(){var e=this;e.angle=90;e.children.forEach(function(t){t.updateFromAngle(e.angle)})};s.prototype.close=function(){var e=this;e.dispatchEvent("beforeanimate");var t=function(){if(e.angle>90){e.dispatchEvent("afteranimate");return}e.children.forEach(function(t){t.updateFromAngle(e.angle)});e.angle++};e.on("tick",t)};createjs.promote(s,"Container");function o(e,t,i){this.Bitmap_constructor(e);this.x=t*i;this.index=i;this.width=t;this.height=e.height;this.sourceRect=new createjs.Rectangle(t*i,0,t,e.height);this.isMoving=false}createjs.extend(o,createjs.Bitmap);o.prototype._calXposFromAngle=function(e){return this.width*Math.cos(e*i)*this.index};o.prototype._calYposFromAngle=function(e){return Math.sin(e*i)*-this.width/2};o.prototype.updateFromAngle=function(e){this.skewY=this.index%2?e:-e;this.y=this._calYposFromAngle(this.skewY);this.x=this._calXposFromAngle(e)};createjs.promote(o,"Bitmap");function c(t){t=t||{};this.Container_constructor();e.extend(this,t);this._setButtons()}createjs.extend(c,createjs.Container);c.prototype._setButtons=function(){var e=this;var t=new h;t.regX=t.width/2;t.regY=t.height/2;t.x=t.width/2;t.y=e.height/2;t.rotation=180;t.on("click",function(){e.dispatchEvent("prevclick")});e.addChild(t);var i=new h;i.regX=i.width/2;i.regY=i.height/2;i.x=e.width-i.width/2;i.y=e.height/2;i.on("click",function(){e.dispatchEvent("nextclick")});e.addChild(i)};createjs.promote(c,"Container");function h(){this.Container_constructor();this.width=100;this.height=100;this.alpha=.2;this.mouseChildren=false;this.cursor="pointer";this.initialize()}createjs.extend(h,createjs.Container);h.prototype.initialize=function(){var e=new createjs.Shape;e.graphics.beginFill("#000");e.graphics.drawCircle(0,0,30);e.x=this.width/2;e.y=this.height/2;this.addChild(e);var t=new createjs.Graphics;t.setStrokeStyle(4).beginStroke("#FFF").moveTo(0,0).lineTo(15,15).lineTo(0,30).endStroke();var i=new createjs.Shape(t);i.regX=15/2;i.regY=30/2;i.x=this.width/2;i.y=this.height/2;this.addChild(i);this.on("mouseover",this.focus);this.on("mouseout",this.blur)};h.prototype.focus=function(){createjs.Tween.get(this).to({alpha:.5,scaleX:1.1,scaleY:1.1},200,createjs.Ease.backOut)};h.prototype.blur=function(){createjs.Tween.get(this).to({alpha:.2,scaleX:1,scaleY:1},200,createjs.Ease.backOut)};createjs.promote(h,"Container");e.fn[t]=function(i){return this.each(function(){if(!e.data(this,"plugin_"+t)){e.data(this,"plugin_"+t,new r(this,i))}})}})(jQuery);